# ETL-процесс загрузки информации о фильмах из БД в ES


## Необходимые требования
Для разврачивания проекта на хостовой машине необходимо наличие:
1. [Docker](https://docs.docker.com/engine/install/)  
1. [docker-compose](https://docs.docker.com/compose/install/)
1. VCS, например [GIT](https://git-scm.com/download/win)
1. Интерпретатор Python версии 3.8 или выше


## Копирование и запуск проекта
1. Скопировать/склонировать репозиторий на хостовую машину,
1. В директории **posstgres_to_es** проекта переименовать файл .env.dist в .env
1. В файле .env заполнить учетные данные:  
   - POSTGRES_HOST - ip-адрес хостовой машины, на которой запускается контейнер с Postgresql  
   - POSTGRES_PORT - порт, на котором работает СУБД postgres, по умолчанию 5432
   - POSTGRES_DB - имя базы данных  
   - POSTGRES_USER - имя пользователя, должно совпадать с именем базы данных
   - POSTGRES_PASSWORD - пароль для пользователя
   - REDIS_HOST - ip-адрес хостовой машины, на которой запускается контейнер с Redis
   - STATE_DB - имя базы данных состояний процесса ETL, которая (база данных) будет храниться в Redis
   - ELASTICSEARCH_HOST - ip-адрес хостовой машины, на которой запускается контейнер с Elastic Search
   - ELASTICSEARCH_PORT - порт, на котором будет работать Elastic Search 

1. В директории **movies_admin** проекта выполнить две команды для запуска контейнеров Redis и Elastic Search
    - ```$ docker-compose build```
    - ```$ docker-compose up-d```

1. Убедиться в том, что на хостовой машине уже запущен сервис Postgres на порту, указанного в предыдущем пункте


# Запуск приложения из командной строки
1. Создать и запустить виртуальное окружение  
1. В директории **movies_admin** выполнить команду ```pip install -r requirements/production.txt```  
1. В директории **movies_admin** выполнить команду ```python app.py ```.
Параметры:
    - --batch_size <int> размер записей БД, обрабатываемых за один проход
    - --interval <int> интервал между опросом базы данных на наличие изменений в секундах
    - --debug если указан данный параметр, то программа запускается в режиме отладки. Т.е. проиcходит одна итерация ETL.

# Контроль хода исполнения программы
Программа автоматически формирует лог-файл log.txt, который можно просматривать во время выполнения программы.
  
# Остановка проекта
Комбинация Ctrl+C